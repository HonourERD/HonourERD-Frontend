<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HonourERD - Step-by-Step Normalisation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="./NewSystem.css">
    <style>
        .scenario-container {
            background: #faf6d8;
            border: 2px solid #000000;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.08);
            margin: 10px auto 20px auto;
            width: 80%;
            max-width: 900px;
            font-family: 'Arial', sans-serif;
            text-align: left;
            line-height: 1.5;
        }


        .scenario-container h2 {
            font-size: 18px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 8px;
        }

        .scenario-intro {
            font-size: 14.5px;
            color: #000000;
            margin-bottom: 8px;
        }


        .points {
            list-style: none;
            padding-left: 0;
            font-size: 14px;
        }

        .solution-text {
            font-size: 14px;
        }

        .issue-list li {
            padding: 0;
            font-weight: normal;
            display: flex;
            align-items: center;
        }


        .issue-list li strong {
            color: #c0392b;
        }


        .task-text {
            font-size: 14px;
            font-weight: bold;
            color: #000000;
            margin-top: 10px;
        }


        .subprocess-box,
        .step-container {
            background-color: white;
            border: 2px solid #0c0900;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            min-height: 250px;
        }

        .highlight-issue {
            color: red;
            font-weight: bold;
        }

        .highlight-fixed {
            color: green;
            font-weight: bold;
        }


        .issue {
            fill: red;
            stroke: black;
        }

        .fixed {
            fill: green;
            stroke: black;
        }

        .highlight-issue {
            color: red;
            font-weight: bold;
        }

        .highlight-fixed {
            color: green;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>HonourERD</h1>

    <div class="scenario-container">
        <h2>Scenario: <span class="highlight">Hospital Data Overload</span></h2>
        <p class="scenario-intro">
            Hospitals rely on vast amounts of patient, doctor, treatment, and billing data. However, CityCare Hospital
            struggles with a disorganized database where everything is stored in a single, unstructured table, leading
            to:
        </p>

        <ul class="issue-list">
            <li class="points"> <strong>Duplicate records:</strong>&nbsp; Patients appear multiple times, causing
                redundancy.</li>
            <li class="points"> <strong>Repetitive doctor details:</strong>&nbsp; The same doctor is listed for multiple
                patients, leading to unnecessary duplication.</li>
            <li class="points"><strong>Slow Processing:</strong>&nbsp; Retrieving patient history takes too long due to
                mixed and redundant data.</li>
            <li class="points"><strong>Billing errors:</strong>&nbsp; Treatments and payments are linked improperly,
                causing financial discrepancies.</li>
        </ul>

        <p class="solution-text">
            Normalise the database step-by-step to fix these issues! (<strong>1NF ‚Üí 2NF ‚Üí 3NF</strong>).
        </p>

        <p class="task-text">
            Start by entering raw store data below!
        </p>
    </div>

    <div id="step-1" class="step-container">
        <h3>Step 1: First Normal Form (1NF)</h3>
        <textarea id="input-1nf" placeholder="Enter attributes for preset tables"></textarea>
        <button id="btn-validate-1nf">Process UNF</button>
        <div id="feedback-1nf"></div>
    </div>

    <hr>

    <div class="step-container">
        <h3>Subprocesses of Achieving 1NF</h3>

        <div class="subprocess-box1">
            <h4>Step 1. Ensure Atomicity</h4>

            <div id="atomicity-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p>‚úÖ Atomicity fixes will appear here.</p>
            </div>

            <button id="btn-fix-atomicity">Apply Fix for Atomicity</button>
            <div id="after-atomicity" class="mermaid"></div>
        </div>

        <div class="subprocess-box1" id="repeating-groups-explanation">
            <h4>Step 2. Eliminate Repeating Groups</h4>

            <div id="repeating-groups-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p>‚úÖ Feedback on repeating groups will appear here.</p>
            </div>

            <button id="btn-fix-repeating-groups">Apply Fix for Repeating Groups</button>
            <div id="after-repeating-groups" class="mermaid"></div>


        </div>
    </div>


    <hr>

    <div id="step-2" class="step-container">
        <h3>Step 2: Second Normal Form (2NF)</h3>
        <p id="explanation-2nf">Identifying and removing partial dependencies.</p>

        <div class="subprocess-box2">
            <h4>Before 2NF</h4>

            <div id="before-2nf-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p id="before-2nf-text">‚úÖ 2NF validation feedback will appear here.</p>
            </div>

            <button id="btn-validate-2nf">Validate 2NF</button>
            <div id="before-2nf" class="mermaid"></div>

        </div>

        <div class="subprocess-box2">
            <h4>After 2NF</h4>

            <div id="after-2nf-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p id="after-2nf-text">‚úÖ Fixes applied during 2NF will be displayed here.</p>
            </div>

            <button id="btn-fix-2nf">Apply Fix for 2NF</button>
            <div id="after-2nf" class="mermaid"></div>

        </div>
    </div>
    <hr>

    <div id="step-3" class="step-container">
        <h3>Step 3: Third Normal Form (3NF)</h3>
        <p id="explanation-3nf">Identifying and removing transitive dependencies.</p>

        <div class="subprocess-box3">
            <h4>Before 3NF</h4>

            <div id="before-3nf-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p id="before-3nf-text">‚úÖ 3NF validation feedback will appear here.</p>
            </div>

            <button id="btn-validate-3nf">Validate 3NF</button>
            <div id="before-3nf" class="mermaid"></div>

        </div>

        <div class="subprocess-box3">
            <h4>After 3NF</h4>

            <div id="after-3nf-feedback"
                style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
                <p id="after-3nf-text">‚úÖ Fixes applied during 3NF will be displayed here.</p>
            </div>

            <button id="btn-fix-3nf">Apply Fix for 3NF</button>
            <div id="after-3nf" class="mermaid"></div>

        </div>
    </div>

    <hr>

    <div id="final-summary-container" class="step-container">
        <h3>Final Normalised Database</h3>
        <p id="final-summary-text">Here‚Äôs what the database looks like after full normalisation.</p>
        <button id="btn-generate-summary">Generate Final Summary</button>

        <div id="final-summary-diagram" class="mermaid"></div>
    </div>


    <button onclick="goToNext()">Next</button>

    <script>
        mermaid.initialize({ startOnLoad: false });


        let feedbackMessages = {
            "1NF": {
                "atomicityFixed": "‚úÖ Atomicity ensured! Names split into First and Last.",
                "noRepeatingGroups": "‚úÖ No repeating groups detected! No changes were necessary.",
                "repeatingGroupsFixed": "‚ö†Ô∏è Repeating groups detected! Moving Medications to a new table."
            },
            "2NF": {
                "partialDependencies": "‚ö†Ô∏è Partial dependency found! Age & InsurancePlan only depend on PatientID.",
                "partialFixApplied": "‚úÖ Partial dependencies fixed! Attributes moved to PatientDetails table.",
                "diagnosisMoved": "‚ö†Ô∏è DiagnosisDetails should be in Appointment. Moving now.",
                "diagnosisFixApplied": "‚úÖ DiagnosisDetails successfully moved to Appointment table."
            },
            "3NF": {
                "transitiveDependency": "‚ö†Ô∏è Specialty should be in Doctor table. Moving it now.",
                "transitiveFixApplied": "‚úÖ Transitive dependencies fixed! Specialty moved to Doctor table."
            }
        };



      
        function resetMermaid(selector) {
            setTimeout(() => {
                document.querySelectorAll(selector).forEach(el => el.removeAttribute("data-processed"));
                mermaid.init(undefined, document.querySelector(selector));
            }, 50);
        }

        function validate1NF() {
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") return;

            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];

            console.log("1NF: Extracted Attributes Before Processing:", attributes);

            let diagramCode = `erDiagram\n  UNF {\n`;
            attributes.forEach(attr => {
                diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
            });
            diagramCode += `  }`;

            let diagramContainer = document.getElementById("feedback-1nf");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`; 

            resetMermaid("#feedback-1nf .mermaid");
        }



        function fixAtomicity() {
          

        
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") return;
        
            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];
        
            let atomicityFixes = {
                "PATIENTNAME": ["PATIENTFIRSTNAME", "PATIENTLASTNAME"],
                "DOCTORNAME": ["DOCTORFIRSTNAME", "DOCTORLASTNAME"]
            };
        
            let tables = {
                "Patient": new Set(["PATIENTID"]),
                "Doctor": new Set() 
            };
        
            let hasAppointment = false;  
        
            attributes.forEach(attr => {
                let cleanAttr = attr.trim().toUpperCase();
        
                if (atomicityFixes[cleanAttr]) {
                    if (cleanAttr.includes("PATIENT")) {
                        atomicityFixes[cleanAttr].forEach(a => tables["Patient"].add(a));
                    } else if (cleanAttr.includes("DOCTOR")) {
                        atomicityFixes[cleanAttr].forEach(a => tables["Doctor"].add(a));
                    }
                } 
                else if (cleanAttr.includes("DOCTOR") || cleanAttr.includes("SPECIALTY") || cleanAttr.includes("SPECIALITY")) {
                    tables["Doctor"].add(cleanAttr);
                } 
                else if (cleanAttr.includes("APPOINTMENT")) {
                    hasAppointment = true; 
                } 
                else {
                    tables["Patient"].add(cleanAttr);
                }
            });
        
          
            if (hasAppointment) {
                tables["Appointment"] = new Set(["APPOINTMENTID", "PATIENTID", "DOCTORID", "APPOINTMENTDATE"]);
                console.log("‚úÖ Appointment table created.");
            } else {
                console.log("‚ùå No appointment attributes found. Appointment table will NOT be created.");
            }
        
            let feedbackMessages = [];
        
            if (attributes.includes("PATIENTNAME")) {
                feedbackMessages.push("‚úÖ PatientName was split into PATIENTFIRSTNAME and PATIENTLASTNAME.");
            }
            if (attributes.includes("DOCTORNAME")) {
                feedbackMessages.push("‚úÖ DoctorName was split into DOCTORFIRSTNAME and DOCTORLASTNAME.");
            }
            if (tables["Doctor"].size === 0) {
                delete tables["Doctor"];
                feedbackMessages.push("‚úÖ No doctor attributes detected, so the Doctor table was removed.");
            } else {
                feedbackMessages.push("‚úÖ A Doctor table was created because doctor-related attributes were found.");
            }
        
            document.getElementById("atomicity-feedback").innerHTML = feedbackMessages.join("<br>");
        
            console.log("‚úÖ Atomicity Fixed Tables:", tables);
        
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        
            let diagramContainer = document.getElementById("after-atomicity");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
            window.atomicityFixedTables = structuredClone(tables);
        
            resetMermaid("#after-atomicity .mermaid");
        }
        

        function fixRepeatingGroups() {
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") {
                console.warn("‚ùå No input detected!");
                return;
            }
        
            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];
        
            let tables = structuredClone(window.atomicityFixedTables || {});
        
            if (!tables["Patient"]) tables["Patient"] = new Set();
        
            if (window.atomicityFixedTables?.Patient) {
                window.atomicityFixedTables.Patient.forEach(attr => tables["Patient"].add(attr));
            }
        
      
            let appointmentAttributes = ["APPOINTMENTID", "APPOINTMENTDATE", "APPOINTMENTTIME"];
            let hasAppointmentData = attributes.some(attr => appointmentAttributes.includes(attr));
        
            if (hasAppointmentData) { 
                if (!tables["Appointment"]) {
                    tables["Appointment"] = new Set(["APPOINTMENTID", "PATIENTID", "APPOINTMENTDATE"]);
                }
        
            
                if (tables["Patient"].has("DIAGNOSIS")) {
                    tables["Appointment"].add("DIAGNOSIS");
                    tables["Patient"].delete("DIAGNOSIS");
                    console.log("‚úÖ Diagnosis moved to Appointment table.");
                }
            }
        
         
            if (tables["Appointment"] && tables["Appointment"].size === 3) {  
                delete tables["Appointment"];
                console.log("‚ùå No appointment-related attributes detected. Appointment table was removed.");
            }
        
       
            let medications = new Set();
            attributes.forEach(attr => {
                if (attr.includes("MEDICATION") || attr.includes("PRESCRIBED")) {
                    medications.add(attr);
                }
            });
        
            if (medications.size > 0) {
                tables["Medications"] = new Set(["MEDICATIONID", "PATIENTID", ...medications]);
                tables["Patient"].delete("MEDICATION");
                console.log("‚úÖ Medications table created.");
            } else {
                delete tables["Medications"];
            }
        
        
            let doctorAttributesFound = attributes.some(attr =>
                attr.includes("DOCTOR") || attr.includes("SPECIALTY") || attr.includes("SPECIALITY")
            );
        
            if (doctorAttributesFound) {
                if (!tables["Doctor"]) tables["Doctor"] = new Set(["DOCTORID"]);
        
            
                if (window.atomicityFixedTables?.Doctor) {
                    window.atomicityFixedTables.Doctor.forEach(attr => tables["Doctor"].add(attr));
                }
        
         
                if (tables["Appointment"]) {
                    tables["Appointment"].add("DOCTORID");
                }
                
                console.log("‚ö†Ô∏è A Doctor table was created.");
            } else {
                delete tables["Doctor"];
            }
        
      
            document.getElementById("repeating-groups-feedback").innerHTML =
                doctorAttributesFound
                    ? "‚ö†Ô∏è  Doctor related attributes were detected and moved to the Doctor table."
                    : "‚ö†Ô∏è No doctor attributes found, so no Doctor table was created.";
        
            console.log("‚úÖ Final Tables After Fixing Repeating Groups:", tables);
        
          
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        
            let diagramContainer = document.getElementById("after-repeating-groups");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
     
            window.repeatingGroupsFixedTables = structuredClone(tables);
        
            resetMermaid("#after-repeating-groups .mermaid");
        }
        



        function validate2NF() {
            console.log(" Validating 2NF...");

            if (!window.repeatingGroupsFixedTables) {
                console.error("Missing Repeating Groups data. Run 'Fix Repeating Groups' first.");
                return;
            }

            let tables = structuredClone(window.repeatingGroupsFixedTables);
            let feedbackMessages = [];

          
            if (tables["Patient"].has("APPOINTMENTID") || tables["Patient"].has("DIAGNOSISDETAILS")) {
                if (!tables["Appointment"]) {
                    tables["Appointment"] = new Set(["APPOINTMENTID", "PATIENTID", "APPOINTMENTDATE"]);
                    feedbackMessages.push("‚ö†Ô∏è Appointment table was missing and has been created.");
                    console.warn("Missing Appointment table. Creating it now...");
                }
            }

          
            if (tables["Patient"].has("DIAGNOSISDETAILS") && tables["Appointment"]) {
                console.warn("Moving DiagnosisDetails from Patient to Appointment...");
                tables["Patient"].delete("DIAGNOSISDETAILS");
                tables["Appointment"].add("DIAGNOSISDETAILS");
                feedbackMessages.push("‚ö†Ô∏è DiagnosisDetails moved from Patient to Appointment.");
            } else {
                console.log("DiagnosisDetails stays in Patient because no appointments exist.");
            }

        
            let partialDependencies = new Set();
            let derivedAttributes = new Set();

            tables["Patient"].forEach(attr => {
                if (attr === "AGE") {
                    derivedAttributes.add(attr);
                }
                if (attr === "INSURANCEPLAN") {
                    partialDependencies.add(attr);
                }
            });

            console.log("2NF: Found Partial Dependencies:", partialDependencies);
            console.log("2NF: Found Derived Attributes:", derivedAttributes);

           
            if (derivedAttributes.has("AGE")) {
                feedbackMessages.push("‚ö†Ô∏è **AGE is a derived attribute** and should be replaced with DATEOFBIRTH in the Patient table.");
            }

            if (partialDependencies.size > 0) {
                feedbackMessages.push("‚ö†Ô∏è Partial dependency detected: Moving INSURANCEPLAN to a new PatientDetails table.");
            }

           
            document.getElementById("before-2nf-text").innerHTML = feedbackMessages.join("<br>");

            console.log("2NF Validation Complete. Updated Tables:", tables);

            
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });

            let beforeContainer = document.getElementById("before-2nf");
            beforeContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`; 

            resetMermaid("#before-2nf .mermaid");

          
            window.before2NFTables = structuredClone(tables);
        }


        function fix2NF() {
            console.log("Fixing 2NF...");

            if (!window.before2NFTables) {
                console.error("Missing 2NF validation data. Run 'Validate 2NF' first.");
                return;
            }

            let tables = structuredClone(window.before2NFTables);
            let feedbackMessages = [];

          
            if (tables["Appointment"] && tables["Appointment"].has("DIAGNOSISDETAILS")) {
                if (!tables["Diagnosis"]) {
                    tables["Diagnosis"] = new Set(["DIAGNOSISID", "APPOINTMENTID"]);
                }
                tables["Diagnosis"].add("DIAGNOSISDETAILS");
                tables["Appointment"].delete("DIAGNOSISDETAILS");
                feedbackMessages.push("‚úÖ Moved DiagnosisDetails from Appointment to Diagnosis table.");
            } else {
                console.log("DiagnosisDetails stays where it is because no Appointment exists.");
            }

         
            if (tables["Patient"].has("AGE")) {
                tables["Patient"].delete("AGE");
                tables["Patient"].add("DATEOFBIRTH");
                feedbackMessages.push("‚úÖ AGE was removed and replaced with DATEOFBIRTH in Patient table.");
            }

         
            if (tables["Patient"].has("INSURANCEPLAN")) {
                if (!tables["PatientDetails"]) {
                    tables["PatientDetails"] = new Set(["PATIENTID"]);
                }
                tables["Patient"].delete("INSURANCEPLAN");
                tables["PatientDetails"].add("INSURANCEPLAN");
                feedbackMessages.push("‚úÖ INSURANCEPLAN moved from Patient to PatientDetails table.");
            }

            console.log("2NF Fix Applied. Updated Tables:", tables);

           
            document.getElementById("after-2nf-text").innerHTML = feedbackMessages.length
                ? feedbackMessages.join("<br>")
                : "‚úÖ No changes needed. Database was already in 2NF.";

       
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });

            let diagramContainer = document.getElementById("after-2nf");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`; 

            resetMermaid("#after-2nf .mermaid");

            
            window.finalTables = structuredClone(tables);
        }

        function validate3NF() {
            console.log("Validating 3NF...");

            if (!window.finalTables) {
                console.error("Missing final tables. Run 'Fix 2NF' first.");
                return;
            }

         
            let tables = structuredClone(window.finalTables);

        
            if (!tables["Doctor"]) {
                tables["Doctor"] = new Set(["DOCTORID"]);
            }

            let transitiveDependencies = new Set();

            Object.keys(tables).forEach(table => {
                tables[table].forEach(attr => {
                    if (
                        (attr.includes("SPECIALTY") || attr.includes("SPECIALITY") || attr.includes("HOSPITAL")) &&
                        !tables["Doctor"].has(attr)
                    ) {
                        transitiveDependencies.add(attr);
                    }
                });
            });

            console.log("üîç 3NF: Found Transitive Dependencies:", transitiveDependencies);

            
            if (transitiveDependencies.size === 0) {
                document.getElementById("before-3nf-text").innerHTML = "‚úÖ The database is already in 3NF. No transitive dependencies found!";
                document.getElementById("before-3nf").innerHTML = "<p>‚úÖ No transitive dependencies detected.</p>";
                return;
            }

           
            let beforeDiagram = `erDiagram\n  Diagnosis {\n    DIAGNOSISID STRING\n    APPOINTMENTID STRING\n`;

            transitiveDependencies.forEach(attr => {
                console.log("Adding transitive attribute to Diagnosis Table:", attr);
                beforeDiagram += `    ${attr} STRING\n`;
            });

            beforeDiagram += `  }\n`;

            let beforeContainer = document.getElementById("before-3nf");
            beforeContainer.innerHTML = `<div class="mermaid">${beforeDiagram}</div>`; 

            console.log("3NF Validation Complete. Updating Mermaid Diagram...");

            resetMermaid("#before-3nf .mermaid");

            document.getElementById("explanation-3nf").innerHTML =
                "‚ö†Ô∏è Transitive dependencies detected! Some attributes depend on non-key attributes.";
        }




        function fix3NF() {
            console.log("Fixing 3NF...");

            if (!window.finalTables) {
                console.error(" Missing final tables. Run 'Fix 2NF' first.");
                return;
            }

          
            let tables = structuredClone(window.finalTables);

            let transitiveDependencies = new Set();

            Object.keys(tables).forEach(table => {
                tables[table].forEach(attr => {
                    if (
                        (attr.includes("SPECIALTY") || attr.includes("SPECIALITY") || attr.includes("HOSPITAL")) &&
                        (!tables["Doctor"] || !tables["Doctor"].has(attr))
                    ) {
                        transitiveDependencies.add(attr);
                    }
                });
            });

            console.log("3NF: Found Transitive Dependencies:", transitiveDependencies);

          
            if (transitiveDependencies.size === 0) {
                console.log("No transitive dependencies found! Database is already in 3NF.");
                document.getElementById("after-3nf-text").innerHTML =
                    "‚úÖ No changes needed! The database is already in 3NF.";
                document.getElementById("after-3nf").innerHTML = "<p>‚úÖ No transitive dependencies detected.</p>";
                return;
            }

        
            if (!tables["Doctor"]) {
                tables["Doctor"] = new Set(["DOCTORID"]);
            }

            transitiveDependencies.forEach(attr => {
                tables["Doctor"].add(attr);
            });

            console.log(" 3NF Fix Applied. Updated Tables:", tables);

          
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });

            let diagramContainer = document.getElementById("after-3nf");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`; 

            resetMermaid("#after-3nf .mermaid");

           
            window.finalTables = structuredClone(tables);
        }

      
        function generateFinalSummaryDiagram() {
            console.log("Generating Final Summary Diagram...");

            if (!window.finalTables) {
                console.error(" Missing final tables. Run 'Fix 3NF' first.");
                document.getElementById("final-summary-text").innerHTML =
                    "‚ùå Error: Final tables are missing. Ensure you complete all normalisation steps.";
                return;
            }

            let tables = structuredClone(window.finalTables);

          
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });

            let diagramContainer = document.getElementById("final-summary-diagram");
            if (!diagramContainer) {
                console.error("Could not find 'final-summary-diagram'. Check your HTML.");
                return;
            }

            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`; 

           
            document.getElementById("final-summary-container").style.display = "block";

        
            document.getElementById("final-summary-text").innerHTML =
                "‚úÖ Normalisation Complete! Below is your final database structure after 3NF.";

        
            resetMermaid("#final-summary-diagram .mermaid");
        }



        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("btn-validate-1nf").addEventListener("click", validate1NF);
            document.getElementById("btn-fix-atomicity").addEventListener("click", fixAtomicity);
            document.getElementById("btn-fix-repeating-groups").addEventListener("click", fixRepeatingGroups);
            document.getElementById("btn-validate-2nf").addEventListener("click", validate2NF);
            document.getElementById("btn-fix-2nf").addEventListener("click", fix2NF);
            document.getElementById("btn-validate-3nf").addEventListener("click", validate3NF);
            document.getElementById("btn-fix-3nf").addEventListener("click", fix3NF);
            document.getElementById("btn-generate-summary").addEventListener("click", generateFinalSummaryDiagram);
        });

        function goToNext() {
            window.location.href = "University.html";
        }           
    </script>


</body>

</html>