<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HonourERD - University Normalisation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="./NewSystem.css">
 
    <style>
        .scenario-container {
            background: #faf6d8;
            border: 2px solid #000000; 
            padding: 10px 15px; 
            border-radius: 8px; 
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.08); 
            margin: 10px auto 20px auto; 
            width: 80%; 
            max-width: 900px; 
            font-family: 'Arial', sans-serif;
            text-align: left;
            line-height: 1.5; 
        }
        
        
        .scenario-container h2 {
            font-size: 18px;
            font-weight: bold;
            color: #000000; 
            margin-bottom: 8px;
        }
        
        
        .scenario-intro {
            font-size: 14.5px;
            color: #000000;
            margin-bottom: 8px;
        }
        
      
        .points {
            list-style: none;
            padding-left: 0;
            font-size: 14px;
        }
        
        .solution-text{
            font-size: 14px;
        }
        .issue-list li {
            padding: 0; 
            font-weight: normal;
            display: flex;
            align-items: center;
        }
        
        
        .issue-list li strong {
            color: #c0392b; 
        }
        
     
        .task-text {
            font-size: 14px;
            font-weight: bold;
            color: #000000;
            margin-top: 10px;
        }


        .subprocess-box,
        .step-container {
            background-color: white;
            border: 2px solid #0c0900;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            min-height: 250px;
        }

        .highlight-issue {
            color: red;
            font-weight: bold;
        }

        .highlight-fixed {
            color: green;
            font-weight: bold;
        }

       
        .issue {
            fill: red;
            stroke: black;
        }

        .fixed {
            fill: green;
            stroke: black;
        }

        .highlight-issue {
            color: red;
            font-weight: bold;
        }

        .highlight-fixed {
            color: green;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>HonourERD</h1>

    <div class="scenario-container">
        <h2>Scenario: <span class="highlight">University Enrollment Chaos</span></h2>
        <p class="scenario-intro">
            EduFlex University is struggling with a disorganized student records system. Right now, all student registrations, courses, faculty details, and grades are crammed into a single, messy table, leading to:
        </p>
    
        <ul class="issue-list">
            <li class="points"> <strong>Duplicate students:</strong> Students appear multiple times if they enroll in different courses.</li>
            <li class="points"> <strong>Course confusion: </strong> "Intro to Computing" vs. "Introduction to Computing" vs. "COMP101" make reports unreliable.</li>
            <li class="points"><strong>Grading errors:</strong> Some students have multiple grades recorded for the same course.</li>
            <li class="points"><strong>Administrative delays:</strong> Finding student history and faculty assignments is painfully slow.</li>
        </ul>
    
        <p class="solution-text">
            Normalize the database step-by-step to fix these issues! (<strong>1NF ‚Üí 2NF ‚Üí 3NF</strong>).
        </p>
    
        <p class="task-text">
            Start by entering raw store data below! 
        </p>
    </div>
    

    <div id="step-1" class="step-container">
        <h3>Step 1: First Normal Form (1NF)</h3>
        <textarea id="input-1nf" placeholder="Enter attributes for preset tables"></textarea>
        <button id="btn-validate-1nf">Process UNF</button>
        <div id="feedback-1nf"></div>
    </div>

    <hr>

    <div class="step-container">
        <h3>Subprocesses of Achieving 1NF</h3>

        <div class="subprocess-box1">
            <h4>Step 1. Ensure Atomicity</h4>
          
        <div id="atomicity-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p>‚úÖ Atomicity fixes will appear here.</p>
        </div>

        <button id="btn-fix-atomicity">Apply Fix for Atomicity</button>
        <div id="after-atomicity" class="mermaid"></div>
        </div>

        <div class="subprocess-box1" id="repeating-groups-explanation">
            <h4>Step 2. Eliminate Repeating Groups</h4>
         
        <div id="repeating-groups-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p>‚úÖ Feedback on repeating groups will appear here.</p>
        </div>

        <button id="btn-fix-repeating-groups">Apply Fix for Repeating Groups</button>
        <div id="after-repeating-groups" class="mermaid"></div>


    </div>
    </div>


    <hr>

    <div id="step-2" class="step-container">
        <h3>Step 2: Second Normal Form (2NF)</h3>
        <p id="explanation-2nf">Identifying and removing partial dependencies.</p> 

        <div class="subprocess-box2">
            <h4>Before 2NF</h4>
           
        <div id="before-2nf-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p id="before-2nf-text">‚úÖ 2NF validation feedback will appear here.</p>
        </div>

        <button id="btn-validate-2nf">Validate 2NF</button>
        <div id="before-2nf" class="mermaid"></div>

        </div>

        <div class="subprocess-box2">
            <h4>After 2NF</h4>
           
        <div id="after-2nf-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p id="after-2nf-text">‚úÖ Fixes applied during 2NF will be displayed here.</p>
        </div>

        <button id="btn-fix-2nf">Apply Fix for 2NF</button>
        <div id="after-2nf" class="mermaid"></div>

        </div>
    </div>
    <hr>

    <div id="step-3" class="step-container">
        <h3>Step 3: Third Normal Form (3NF)</h3>
        <p id="explanation-3nf">Identifying and removing transitive dependencies.</p>

        <div class="subprocess-box3">
            <h4>Before 3NF</h4>
         
        <div id="before-3nf-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p id="before-3nf-text">‚úÖ 3NF validation feedback will appear here.</p>
        </div>

        <button id="btn-validate-3nf">Validate 3NF</button>
        <div id="before-3nf" class="mermaid"></div>

        </div>

        <div class="subprocess-box3">
            <h4>After 3NF</h4>
                 
        <div id="after-3nf-feedback" style="background-color: #f0f0f0; padding: 10px; border-left: 4px solid #28a745;">
            <p id="after-3nf-text">‚úÖ Fixes applied during 3NF will be displayed here.</p>
        </div>

        <button id="btn-fix-3nf">Apply Fix for 3NF</button>
        <div id="after-3nf" class="mermaid"></div>

        </div>
    </div>

    <hr>

    <div id="final-summary-container" class="step-container">
        <h3>Final Normalized Database</h3>
        <p id="final-summary-text">Here‚Äôs what the database looks like after full normalization.</p>
        <button id="btn-generate-summary">Generate Final Summary</button>

        <div id="final-summary-diagram" class="mermaid"></div> 
    </div>
    
    <button onclick="goToNext()">Next</button>


    <script>
        mermaid.initialize({ startOnLoad: false });

        function formatFeedback(message) {
            if (message.includes("‚ö†Ô∏è")) {
                return message.replace("‚ö†Ô∏è", `<span style="color: red; font-weight: bold;">‚ö†Ô∏è</span>`);
            }
            if (message.includes("üí°")) {
                return message.replace("üí°", `<span style="color: #ff9800; font-weight: bold;">üí°</span>`);
            }
            if (message.includes("‚úÖ")) {
                return message.replace("‚úÖ", `<span style="color: green; font-weight: bold;">‚úÖ</span>`);
            }
            if (message.includes("‚ùå")) {
                return message.replace("‚ùå", `<span style="color: darkred; font-weight: bold;">‚ùå</span>`);
            }
            return message;
        }
        
        
              
        let feedbackMessages = {
            "1NF": {
                "atomicityFixed": "‚úÖ Atomicity ensured! StudentName split into StudentFirstName and StudentLastName.",
                "noRepeatingGroups": "‚úÖ No repeating groups detected! No changes were necessary.",
                "repeatingGroupsFixed": "‚ö†Ô∏è Repeating groups detected! Moving CourseGrades to Enrollment table."
            },
            "2NF": {
                "partialDependencies": "‚ö†Ô∏è Partial dependency found! Grade & LecturerID only depend on CourseID.",
                "partialFixApplied": "‚úÖ Partial dependencies fixed! Attributes moved to Enrollment table.",
                "courseMoved": "‚ö†Ô∏è Course information should be stored separately from students. Moving now.",
                "courseFixApplied": "‚úÖ Course details successfully moved to Course table."
            },
            "3NF": {
                "transitiveDependency": "‚ö†Ô∏è Lecturer details should be in the Lecturer table. Moving them now.",
                "transitiveFixApplied": "‚úÖ Transitive dependencies fixed! Lecturer details moved to Lecturer table."
            }
        };
        



      
        function resetMermaid(selector) {
            setTimeout(() => {
                document.querySelectorAll(selector).forEach(el => el.removeAttribute("data-processed"));
                mermaid.init(undefined, document.querySelector(selector));
            }, 50);
        }

        function validate1NF() {
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") return;
        
            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];
        
            console.log(" 1NF: Extracted Attributes Before Processing:", attributes);
        
            let diagramCode = `erDiagram\n  UNF {\n`;
            attributes.forEach(attr => {
                diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
            });
            diagramCode += `  }`;
        
            let diagramContainer = document.getElementById("feedback-1nf");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
            resetMermaid("#feedback-1nf .mermaid");
        }
        


        function fixAtomicity() {
            console.log(" Fixing Atomicity...");
        
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") return;
        
            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];
        
            let atomicityFixes = {
                "STUDENTNAME": ["STUDENTFIRSTNAME", "STUDENTLASTNAME"],
                "LECTURERNAME": ["LECTURERFIRSTNAME", "LECTURERLASTNAME"] 
            };
        
            let tables = {
                "Student": new Set(["STUDENTID"]),
                "Lecturer": new Set() 
            };
        
            attributes.forEach(attr => {
                let cleanAttr = attr.trim().toUpperCase();
        
                
                if (atomicityFixes[cleanAttr]) {
                    if (cleanAttr.includes("STUDENT")) {
                        atomicityFixes[cleanAttr].forEach(a => tables["Student"].add(a));
                    } else if (cleanAttr.includes("LECTURER")) {
                        atomicityFixes[cleanAttr].forEach(a => tables["Lecturer"].add(a)); 
                    }
                } 
               
                else if (cleanAttr.includes("LECTURER") || cleanAttr.includes("DEPARTMENT")) {
                    tables["Lecturer"].add(cleanAttr);
                }
             
                else {
                    tables["Student"].add(cleanAttr);
                }
            });
        
            let feedbackMessages = [];
        
         
            if (attributes.includes("STUDENTNAME")) {
                feedbackMessages.push("‚úÖ StudentName was split into STUDENTFIRSTNAME and STUDENTLASTNAME.");
            }
        
        
            if (attributes.includes("LECTURERNAME")) {
                feedbackMessages.push("‚úÖ LecturerName was split into LECTURERFIRSTNAME and LECTURERLASTNAME.");
            }

            if (tables["Lecturer"].size === 0) {
                console.warn("Lecturer table is empty, removing it...");
                delete tables["Lecturer"];
                feedbackMessages.push("‚úÖ No lecturer attributes detected, so the Lecturer table was removed.");
            }
        

            feedbackMessages = feedbackMessages.map(formatFeedback);
            document.getElementById("atomicity-feedback").innerHTML = feedbackMessages.join("<br>");
        
            console.log("Atomicity Fixed Tables:", tables);
        
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        
            let diagramContainer = document.getElementById("after-atomicity");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
            window.atomicityFixedTables = structuredClone(tables);
        
            resetMermaid("#after-atomicity .mermaid");
        }
        
        
        function fixRepeatingGroups() {
            console.log("üîß Fixing Repeating Groups...");
        
            let userInput = document.getElementById("input-1nf").value.trim();
            if (userInput === "") {
                console.warn(" No input detected!");
                return;
            }
        
            let attributes = [...new Set(userInput.split(",").map(attr => attr.trim().toUpperCase()))];
        
     
            let tables = structuredClone(window.atomicityFixedTables || {
                "Student": new Set(["STUDENTID"]),
                "Course": new Set(["COURSEID", "COURSENAME", "CREDITS"])
            });
    
            if (!tables["Enrollment"]) {
                tables["Enrollment"] = new Set(["STUDENTID", "COURSEID"]);
            }
        
 
            if (!tables["Lecturer"] && attributes.includes("LECTURERID")) {
                tables["Lecturer"] = new Set(["LECTURERID"]);
            }
        

            let repeatingAttributes = new Set();
            attributes.forEach(attr => {
                if (attr.includes("GRADE") || attr.includes("LECTURERID")) {
                    repeatingAttributes.add(attr);
                }
            });
        

            if (repeatingAttributes.size > 0) {
                repeatingAttributes.forEach(attr => {
                    tables["Enrollment"].add(attr);
                    if (tables["Student"]?.has(attr)) {
                        tables["Student"].delete(attr);
                    }
                    if (tables["Course"]?.has(attr)) {
                        tables["Course"].delete(attr);
                    }
                    if (attr === "LECTURERID" && tables["Lecturer"]) {
                        tables["Lecturer"].add(attr);
                    }
                });
            }
        
    
            let feedbackMessages = [];
            if (repeatingAttributes.size > 0) {
                feedbackMessages.push(
                    `‚úÖ Repeating groups detected and moved to the Enrollment table! The following attributes were moved: 
                    <ul>${[...repeatingAttributes].map(attr => `<li>${attr}</li>`).join("")}</ul>`
                );
            } else {
                feedbackMessages.push("‚úÖ No repeating groups detected! No changes were necessary.");
            }
        
     
            feedbackMessages = feedbackMessages.map(formatFeedback);
            document.getElementById("repeating-groups-feedback").innerHTML = feedbackMessages.join("<br>");
        
            console.log(" Repeating Groups Fixed. Updated Tables:", tables);
        
        
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        

            document.getElementById("after-repeating-groups").innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
           
            window.repeatingGroupsFixedTables = structuredClone(tables);
            resetMermaid("#after-repeating-groups .mermaid");
        }
        
        


        function validate2NF() {
            console.log("Validating 2NF...");
        
            if (!window.repeatingGroupsFixedTables) {
                console.error("Repeating Groups step must be completed first.");
                return;
            }
        
            let tables = structuredClone(window.repeatingGroupsFixedTables);
            let feedbackMessages = [];
        
        
            if (!tables["Enrollment"]) {
                console.warn("Missing Enrollment table. Creating it now...");
                tables["Enrollment"] = new Set(["STUDENTID", "COURSEID"]);
                feedbackMessages = feedbackMessages.map(formatFeedback);
                feedbackMessages.push(
                    `<span style="color: orange;">‚ö†Ô∏è The Enrollment table was missing and has been created.</span> 
                    This table helps eliminate **partial dependencies** by ensuring attributes that relate to specific courses belong to Enrollment instead of Student.`
                );
            }
        
       
            if (tables["Student"].has("GRADE")) {
                tables["Student"].delete("GRADE");
                tables["Enrollment"].add("GRADE");
                feedbackMessages = feedbackMessages.map(formatFeedback);
                feedbackMessages.push(
                    `<span style="color: green;">‚úÖ 'GRADE' has been moved from Student to Enrollment.</span> 
                    **A grade is assigned to a student for a specific course, not just to the student overall.**`
                );
            }
        
      
            if (!tables["Lecturer"]) {
                tables["Lecturer"] = new Set(["LECTURERID"]);
            }
        

            if (tables["Student"].has("LECTURERID")) {
                tables["Student"].delete("LECTURERID");
                tables["Lecturer"].add("LECTURERID");
                tables["Enrollment"].add("LECTURERID");
                feedbackMessages = feedbackMessages.map(formatFeedback);
                feedbackMessages.push(
                    `<span style="color: green;">‚úÖ 'LECTURERID' has been moved from Student to Lecturer & Enrollment.</span> 
                    **Lecturers are independent entities and should not be stored in Student.** This also allows tracking which lecturer teaches which course.`
                );
            }
        

            if (!tables["Course"]) {
                tables["Course"] = new Set(["COURSEID"]);
            }
        
 
            if (tables["Student"].has("COURSEID")) {
                tables["Student"].delete("COURSEID");
                tables["Enrollment"].add("COURSEID");
                feedbackMessages = feedbackMessages.map(formatFeedback);
                feedbackMessages.push(
                    `<span style="color: green;">‚úÖ 'COURSEID' has been moved from Student to Enrollment.</span> 
                    **Students enroll in multiple courses, so storing COURSEID in Student would lead to redundancy.**`
                );
            }
        
            console.log(" 2NF Validation Complete. Updated Tables:", tables);
        
     
            feedbackMessages = feedbackMessages.map(formatFeedback);
            document.getElementById("before-2nf-text").innerHTML = feedbackMessages.length
                ? feedbackMessages.join("<br><br>")
                : `<span style="color: green;">‚úÖ No partial dependencies found. The database is already in 2NF.</span>`;
   
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        
            let beforeContainer = document.getElementById("before-2nf");
            beforeContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
            resetMermaid("#before-2nf .mermaid");
        
 
            window.before2NFTables = structuredClone(tables);
        }
        
        
        function fix2NF() {
            console.log(" Fixing 2NF...");
        
            if (!window.before2NFTables) {
                console.error(" Missing 2NF validation data. Run 'Validate 2NF' first.");
                return;
            }
        
            let tables = structuredClone(window.before2NFTables);
            let feedbackMessages = [];
        
            if (!tables["Enrollment"]) {
                tables["Enrollment"] = new Set(["STUDENTID", "COURSEID"]);
            }
        
    
            if (tables["Student"].has("GRADE")) {
                tables["Student"].delete("GRADE");
                tables["Enrollment"].add("GRADE");
                feedbackMessages.push("‚úÖ Moved 'GRADE' from Student to Enrollment table.");
            }

            if (!tables["Course"]) {
                tables["Course"] = new Set(["COURSEID"]);
            }
        
     
            if (!tables["Enrollment"].has("COURSEID")) {
                tables["Enrollment"].add("COURSEID");
            }
            if (tables["Student"].has("COURSEID")) {
                tables["Student"].delete("COURSEID");
                feedbackMessages.push("‚úÖ Removed 'COURSEID' from Student (since it belongs in Enrollment).");
            }
        
    
            if (!tables["Lecturer"]) {
                tables["Lecturer"] = new Set(["LECTURERID"]);
            }
        
            if (tables["Student"].has("LECTURERID")) {
                tables["Student"].delete("LECTURERID");
                tables["Lecturer"].add("LECTURERID");
                tables["Enrollment"].add("LECTURERID");
                feedbackMessages.push("‚úÖ Moved 'LECTURERID' from Student to Lecturer and Enrollment tables.");
            }
        
            console.log("‚úÖ 2NF Fix Applied. Updated Tables:", tables);
        

            feedbackMessages = feedbackMessages.map(formatFeedback);
            document.getElementById("after-2nf-text").innerHTML = feedbackMessages.length
                ? feedbackMessages.join("<br>")
                : "‚úÖ No changes needed. Database was already in 2NF.";
        

            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        
            let diagramContainer = document.getElementById("after-2nf");
            diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
        
            resetMermaid("#after-2nf .mermaid");
        
    
            window.finalTables = structuredClone(tables);
        }
        
        
        function validate3NF() {
            console.log(" Validating 3NF...");
        
            if (!window.finalTables) {
                console.error(" Missing final tables. Run 'Fix 2NF' first.");
                return;
            }
        
            let tables = structuredClone(window.finalTables);
            let feedbackMessages = [];
        
            if (!tables["Lecturer"]) {
                console.warn(" Missing Lecturer table. Creating it now...");
                tables["Lecturer"] = new Set(["LECTURERID"]);
            }
        
     
            if (!tables["Course"]) {
                console.warn(" Missing Course table. Creating it now...");
                tables["Course"] = new Set(["COURSEID"]);
            }
        

            let transitiveDependencies = new Set();
            
            Object.keys(tables).forEach(table => {
                tables[table].forEach(attr => {
                    if (
                        (attr.includes("LECTURERNAME") && !tables["Lecturer"].has(attr)) ||
                        (attr.includes("COURSENAME") && !tables["Course"].has(attr)) ||
                        (attr.includes("DEPARTMENT") && !tables["Lecturer"].has(attr))
                    ) {
                        transitiveDependencies.add(attr);
                    }
                });
            });
        
            console.log("3NF: Found Transitive Dependencies:", transitiveDependencies);
        
         
            if (transitiveDependencies.size === 0) {
                document.getElementById("before-3nf-text").innerHTML =
                    formatFeedback("‚úÖ The database is already in 3NF. No transitive dependencies found!");
                return;
            }
        

            feedbackMessages.push(
                `‚ö†Ô∏è <strong>Transitive dependencies detected:</strong> ${[...transitiveDependencies].join(
                    ", "
                )}. These attributes should be moved to their respective tables (Lecturer or Course).`
            );

            document.getElementById("before-3nf-text").innerHTML = feedbackMessages.map(formatFeedback).join("<br>");
        
       
            let beforeDiagram = `erDiagram\n  Enrollment {\n    STUDENTID STRING\n    COURSEID STRING\n    GRADE STRING\n`;
        
            transitiveDependencies.forEach(attr => {
                console.log("‚ûï Adding transitive attribute to Enrollment Table:", attr);
                beforeDiagram += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
            });
        
            beforeDiagram += `  }\n`;
        
            let beforeContainer = document.getElementById("before-3nf");
            beforeContainer.innerHTML = `<div class="mermaid">${beforeDiagram}</div>`;
        
            console.log("3NF Validation Complete. Updating Mermaid Diagram...");
        
            resetMermaid("#before-3nf .mermaid");
        }
        
        function fix3NF() {
            console.log(" Fixing 3NF...");
        
            if (!window.finalTables) {
                console.error("Missing final tables. Run 'Fix 2NF' first.");
                return;
            }
        
          
            let tables = structuredClone(window.finalTables);
            let feedbackMessages = [];
        
           
            if (!tables["Lecturer"]) {
                console.warn("Missing Lecturer table. Creating it now...");
                tables["Lecturer"] = new Set(["LECTURERID"]);
            }
            if (!tables["Course"]) {
                console.warn("Missing Course table. Creating it now...");
                tables["Course"] = new Set(["COURSEID"]);
            }
        
            let transitiveDependencies = new Set();
        
            Object.keys(tables).forEach(table => {
                tables[table].forEach(attr => {
                    if (attr.includes("LECTURERNAME") && !tables["Lecturer"].has(attr)) {
                        transitiveDependencies.add(attr);
                    }
                    if (attr.includes("COURSENAME") && !tables["Course"].has(attr)) {
                        transitiveDependencies.add(attr);
                    }
                    if (attr.includes("DEPARTMENT") && !tables["Lecturer"].has(attr)) {
                        transitiveDependencies.add(attr);
                    }
                });
            });
        
            console.log(" 3NF: Found Transitive Dependencies:", transitiveDependencies);
        
        
            if (transitiveDependencies.size === 0) {
                document.getElementById("after-3nf-text").innerHTML =
                    formatFeedback("‚úÖ No changes needed! The database is already in 3NF.");
                return;
            }
        
      
            transitiveDependencies.forEach(attr => {
                if (attr.includes("LECTURERNAME") || attr.includes("DEPARTMENT")) {
                    tables["Lecturer"].add(attr);
                } else if (attr.includes("COURSENAME")) {
                    tables["Course"].add(attr);
                }
       
                Object.keys(tables).forEach(table => {
                    if (tables[table].has(attr) && table !== "Lecturer" && table !== "Course") {
                        tables[table].delete(attr);
                    }
                });
            });
        
     
            feedbackMessages.push(
                `‚úÖ Transitive dependencies removed and correctly placed! The following attributes were moved: 
                <ul>${[...transitiveDependencies].map(attr => `<li>${attr}</li>`).join("")}</ul>`
            );
        
            console.log(" 3NF Fix Applied. Updated Tables:", tables);
        
      
            let diagramCode = `erDiagram\n`;
            Object.keys(tables).forEach(table => {
                diagramCode += `  ${table} {\n`;
                tables[table].forEach(attr => {
                    diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                });
                diagramCode += `  }\n`;
            });
        

            document.getElementById("after-3nf").innerHTML = `<div class="mermaid">${diagramCode}</div>`;
            document.getElementById("after-3nf-text").innerHTML = feedbackMessages.map(formatFeedback).join("<br>");
        
            resetMermaid("#after-3nf .mermaid");
        
      
            window.finalTables = structuredClone(tables);
        }
        
        
            function generateFinalSummaryDiagram() {
                console.log(" Generating Final Summary Diagram...");
            
                if (!window.finalTables) {
                    console.error(" Missing final tables. Run 'Fix 3NF' first.");
                    document.getElementById("final-summary-text").innerHTML =
                        "‚ùå Error: Final tables are missing. Ensure you complete all normalization steps.";
                    return;
                }
            
                let tables = structuredClone(window.finalTables);
            
                let diagramCode = `erDiagram\n`;
                Object.keys(tables).forEach(table => {
                    diagramCode += `  ${table} {\n`;
                    tables[table].forEach(attr => {
                        diagramCode += `    ${attr.replace(/\s+/g, "_")} STRING\n`;
                    });
                    diagramCode += `  }\n`;
                });
            
                let diagramContainer = document.getElementById("final-summary-diagram");
                if (!diagramContainer) {
                    console.error(" Could not find 'final-summary-diagram'. Check your HTML.");
                    return;
                }
            
                diagramContainer.innerHTML = `<div class="mermaid">${diagramCode}</div>`;
            
               
                document.getElementById("final-summary-container").style.display = "block";
                
                document.getElementById("final-summary-text").innerHTML =
                    "‚úÖ Normalization Complete! Below is your final database structure after 3NF.";
            
                resetMermaid("#final-summary-diagram .mermaid");
            }
            
            

       
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("btn-validate-1nf").addEventListener("click", validate1NF);
            document.getElementById("btn-fix-atomicity").addEventListener("click", fixAtomicity);
            document.getElementById("btn-fix-repeating-groups").addEventListener("click", fixRepeatingGroups);
            document.getElementById("btn-validate-2nf").addEventListener("click", validate2NF);
            document.getElementById("btn-fix-2nf").addEventListener("click", fix2NF);
            document.getElementById("btn-validate-3nf").addEventListener("click", validate3NF);
            document.getElementById("btn-fix-3nf").addEventListener("click", fix3NF); 
            document.getElementById("btn-generate-summary").addEventListener("click", generateFinalSummaryDiagram);
        });

        function goToNext() {
            window.location.href = "Store.html"; 
        }
                    

    </script>


</body>

</html>